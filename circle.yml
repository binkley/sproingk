dependencies:
  override:
    - ./mvnw -B dependency:go-offline

test:
  override:
    - ./mvnw -B clean verify
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find target/{surefire,failsafe}-reports -type f -name TEST\*.xml -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

deployment:
  prod:
    branch: master
    commands:
      # Until boxfuse groks Spring Boot 2.0, tell it where health is
      - ./mvnw -B boxfuse:run -Dboxfuse.env=prod -Dboxfuse.healthcheck.path=/application/health
    post:
      - ./health-check.py
